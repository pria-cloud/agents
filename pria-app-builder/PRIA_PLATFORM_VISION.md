# PRIA Platform Vision & Architecture Summary

**Document Purpose**: Comprehensive overview of the PRIA platform vision for development reference  
**Created**: 2025-01-28  
**Status**: Living document based on current specifications

---

## üéØ **Core Vision: AI-Native Development Platform**

PRIA is a **multi-agent platform** that enables **autonomous AI agents to generate, manage, and deploy production-ready workspace applications** through sophisticated agent-to-agent coordination. Humans act as **product owners and architects**, not developers.

### **Paradigm Shift:**
- **Humans don't code** - they make requests through conversational interfaces
- **Agents author everything** - code, schemas, UIs, workflows, tests, deployments
- **Humans approve/reject** - agent outputs go through human review and compliance validation
- **Best-practice enforcement** - all outputs validated against centralized catalogue

---

## üèóÔ∏è **Platform Architecture Overview**

### **Core Components:**

1. **Admin Console** (Next.js on Vercel)
   - Internal platform management interface
   - Conversational app builder for workspace applications
   - Agent workflow monitoring and approval systems
   - Best-practice catalogue management

2. **Agent Mesh** (Python agents on Fly.io)
   - **App-Builder Agent**: Generates Next.js workspace applications
   - **Schema-Composer Agent**: Designs and evolves database schemas
   - **Workflow-Composer Agent**: Creates Cortex workflow DSL
   - **Test-Harness Agent**: Generates comprehensive test suites
   - **Deployment Agent**: Manages CI/CD and environment promotion
   - **Domain-Expert Agent**: Provides domain-specific guidance
   - **Integrator Agent**: Handles external SaaS/API connections

3. **A2A Gateway** (Go service)
   - Routes intents between agents using capability-based routing
   - Handles agent authentication via JWT scopes (`can_handle:*`)
   - Maintains MCP (Multi-Agent Conversation Protocol) context

4. **Supabase Backend** (Unified database + services)
   - **Single database** serving both platform orchestration and generated apps
   - **Workspace isolation** via `workspace_id` and Row-Level Security
   - Edge Functions, Realtime, Auth services

5. **Generated Workspace Applications**
   - **Production Next.js apps** created by agents
   - **Live in separate repositories** with automated CI/CD
   - **Share common database** with workspace isolation
   - **Can use shared or custom table structures**

---

## üóÑÔ∏è **Unified Database Architecture**

### **Single Supabase Database Strategy:**

All applications (platform + generated apps) run on **one Supabase database** with strict **workspace isolation**:

#### **Platform Tables** (Orchestration Layer)
```sql
-- Core platform orchestration
workspaces, users, sessions, requirements, workflow_sessions
-- Agent infrastructure  
agent_registry, intent_log, subagent_contexts
-- Deployment pipeline
deployment_plans, deployment_executions, deployment_logs
-- Error recovery
sandbox_health_monitoring, recovery_executions
```

#### **Shared Best-Practice Tables** (Domain Templates)
```sql
-- Common business objects shared across workspaces
suppliers, customers, products, orders, invoices
expenses, budgets, projects, tasks
-- Each with workspace_id isolation
```

#### **Custom Application Tables** (Workspace-Specific)
```sql
-- Generated by Schema-Composer Agent for custom apps
workspace_specific_entities (workspace_id, ...)
-- Custom fields extending shared tables
-- Custom relationships and business logic
```

### **Workspace Isolation Pattern:**
```sql
-- MANDATORY: Every table includes workspace_id
CREATE TABLE any_table (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    workspace_id UUID NOT NULL REFERENCES workspaces(id), -- REQUIRED
    ...
);

-- MANDATORY: RLS policies for tenant isolation
ALTER TABLE any_table ENABLE ROW LEVEL SECURITY;
CREATE POLICY "workspace_isolation" ON any_table
FOR ALL USING (workspace_id = (auth.jwt()->>'workspace_id')::uuid);
```

---

## ü§ñ **Agent Coordination & Capabilities**

### **Agent-to-Agent Communication:**
- **Intent-based messaging** via A2A Gateway
- **Capability routing** using `can_handle:*` scopes
- **MCP context preservation** across agent handoffs
- **Sub-intent delegation** (App-Builder ‚Üí Schema-Composer ‚Üí Test-Harness)

### **Agent Capability Examples:**
```json
{
  "agent": "schema-composer",
  "capabilities": [
    "can_handle:schema.synthesise",
    "can_handle:schema.rollback",
    "can_handle:schema.validate"
  ]
}
```

### **Authentication & Authorization:**
```json
{
  "sub": "agent-uuid",
  "role": "agent", 
  "workspace_id": "workspace-uuid",
  "scopes": [
    "workspace:read",
    "can_handle:schema.synthesise",
    "best_practice:enforce"
  ]
}
```

---

## üìö **Best-Practice Catalogue System**

### **Purpose:**
Centralized repository of **domain-specific templates** that workspaces can install and customize.

### **Structure:**
```yaml
domain: finance
version: 1.0.0
spec:
  processes: [Expense Approval, Budget Planning]
  workflows: [ExpenseApprovalWorkflow DSL]
  data_models: [Expense, Budget entities]
  integrations: [Slack, SAP APIs]  
  ui_layouts: [ExpenseForm, ManagerDashboard]
```

### **App Classification Decision Point:**
During the development workflow, there's a **critical decision step**:

1. **Domain App** (Best-Practice):
   - Uses shared table structures from catalogue
   - Pre-validated workflows and UI patterns
   - Faster deployment, lower compliance risk
   - Can be customized within approved parameters

2. **Custom App**:
   - Creates new table structures
   - Custom business logic and workflows  
   - Requires additional compliance validation
   - Higher flexibility, higher review requirements

---

## üîÑ **Application Development Workflow**

### **7-Phase Development Process:**

1. **Requirements Gathering** (Requirements Analyst Agent)
   - Conversational discovery with intelligent extraction
   - Domain classification and catalogue matching
   - Stakeholder validation workflows

2. **Architecture & Technical Design** (System Architect Agent)
   - **Decision Point**: Domain vs Custom app classification
   - Schema design (shared tables vs custom tables)
   - API architecture and integration planning

3. **Implementation Planning** (Implementation Planner Agent)
   - Task breakdown with dependency mapping
   - Resource estimation and sprint planning
   - Parallel processing coordination

4. **Development & Implementation** (Code Generator Agent)
   - Production-ready Next.js application generation
   - Schema implementation via Schema-Composer Agent
   - Workflow creation via Workflow-Composer Agent

5. **Testing & Quality Assurance** (QA Engineer Agent)
   - Comprehensive test suite generation
   - PRIA compliance validation
   - Performance and accessibility testing

6. **Final Validation & Code Review** (Security Auditor Agent)
   - Security audit and vulnerability assessment
   - Best-practice catalogue compliance check
   - Deployment readiness verification

7. **Deployment & Monitoring** (Deployment Specialist Agent)
   - Production deployment with monitoring setup
   - Performance metrics and error tracking
   - Operational readiness validation

### **Human Interaction Model:**
- **Humans submit requests** via conversational interfaces
- **Agents generate all outputs** (code, schemas, tests, deployments)
- **Humans review and approve** agent-generated artifacts
- **Compliance validation** ensures all outputs meet standards
- **One-click deployment** after human approval

---

## üõ°Ô∏è **Security & Compliance Architecture**

### **Multi-Tenant Security:**
- **Workspace isolation** at database level via RLS
- **JWT-based authentication** with workspace scopes
- **Agent capability restrictions** via `can_handle:*` scopes
- **Audit trail** for all agent actions and human approvals

### **Best-Practice Enforcement:**
- **Automatic compliance validation** against catalogue standards
- **Security scanning** for hardcoded secrets, PII exposure
- **Performance benchmarks** and accessibility requirements
- **Data classification** and DLP integration

### **Deployment Security:**
- **Infrastructure as Code** with version control
- **Automated testing** including security and compliance tests
- **Rollback capabilities** for schema and application changes
- **Environment isolation** (dev/staging/production)

---

## üéØ **Current Development Context**

### **What We're Building:**
The **custom app builder component** of the larger PRIA platform - specifically the `/workspace-apps` capability in the Admin Console that allows:

- **Conversational app specification** through Claude Code SDK
- **7-phase development workflow** with agent coordination
- **E2B sandbox integration** for isolated development environments
- **Real-time progress tracking** and human approval workflows
- **GitHub integration** for version control and deployment

### **Our Role in the Ecosystem:**
- **Builder App** (our current work): Orchestrates the app development workflow
- **Target App** (E2B environment): Executes Claude Code SDK to generate applications
- **Database Schema**: Consolidated schema supports both orchestration and generated apps
- **Agent Communication**: Integrates with the broader A2A agent mesh

### **Key Architectural Decisions:**
1. **Split Architecture**: Builder App orchestrates, Target Apps generate
2. **Unified Database**: Single Supabase with workspace isolation
3. **Agent Delegation**: Never generate code directly, always delegate to agents
4. **Claude Code SDK**: Official TypeScript `query()` pattern for agent execution
5. **Compliance First**: All outputs validated against PRIA standards

---

## üöÄ **Future Vision**

### **Platform Evolution:**
- **Expanded Agent Mesh**: More specialized agents for different domains
- **Real-time Collaboration**: Multiple humans working with agents simultaneously  
- **Marketplace Ecosystem**: Third-party agents and best-practice templates
- **Self-Learning System**: Agents improve based on usage patterns and feedback

### **Business Model:**
- **Platform as a Service**: Workspaces pay for agent-generated applications
- **Best-Practice Catalogue**: Premium domain templates and compliance modules
- **Custom Development**: High-touch custom app development with agent assistance
- **Integration Marketplace**: Pre-built connectors and data sources

---

## üìã **Development Guidelines**

### **For Our Current Work:**
1. **Follow Split Architecture**: Builder App orchestrates, never generates Target App code
2. **Maintain Workspace Isolation**: All database queries must include `workspace_id`
3. **Use Consolidated Schema**: Single source of truth for all database definitions
4. **Agent Communication**: Integrate with A2A patterns and capability routing
5. **Claude Code SDK**: Use official TypeScript patterns, not CLI commands
6. **Compliance Validation**: Ensure all outputs meet PRIA architectural standards

### **Success Criteria:**
- **Seamless Agent Coordination**: Builder App successfully delegates to Target Apps
- **Unified Database Access**: Both platform and generated apps use same database safely
- **Human Approval Workflows**: Clear review and approval interfaces for agent outputs
- **Production Readiness**: Generated applications meet enterprise deployment standards
- **Best-Practice Integration**: Support for both domain and custom app classification

---

This vision represents a **paradigm shift** from traditional development to **AI-native application generation**, where autonomous agents become the primary developers and humans focus on product strategy, architecture, and governance.

The platform enables **rapid, compliant, and scalable** workspace application development while maintaining **enterprise-grade security and operational excellence**.